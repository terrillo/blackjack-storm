Vue.component("c-card",{template:"#template-card",props:["details"],data:function(){var a="playing-card--"+this.details.suit+" ",b=this.details.value;this.details.flipped||(a+="playing-card--back");return{extras:a,val:b}}});
if(null!==document.getElementById("view--auth"))var viewAuth=new Vue({el:"#view--auth",data:{username:"",email:"",password:"",error:!1,view:!1,info:!1},created:function(){var a=this;firebase.auth().onAuthStateChanged(function(b){a.info=b})},watch:{info:function(){null!==this.info&&null==document.getElementById("view--gameboard")&&(location.href="/play-now");null==this.info&&null!==document.getElementById("view--gameboard")&&(location.href="/")}},methods:{modal:function(a){this.view=a},log_in:function(){var a=
this;firebase.auth().signInWithEmailAndPassword(this.email,this.password).then(function(b){a.info=b.user;a.modal(!1)}).catch(function(b){a.error=b.message})},sign_up:function(){var a=this;firebase.auth().createUserWithEmailAndPassword(this.email,this.password).then(function(b){a.info=b.user;a.modal(!1);firebase.auth().currentUser.updateProfile({displayName:a.username})}).catch(function(b){a.error=b.message})},sign_out:function(){firebase.auth().signOut()}}});
if(null!==document.getElementById("view--gameboard"))var default_interval=500,viewGameboard=new Vue({el:"#view--gameboard",data:{delay_interval:default_interval,message:"Welcome!",state:"new-game",deck:[],table:{rewarded:!1,bet:1,payout:0},player:{chips:0,demerits:0,info:!1,new:!1,current_rank:!1},hands:{dealer:[],player:[]},totals:{player:0,dealer:0},template:{card:{value:0,suit:0,flipped:!1}},leaderboard:[]},created:function(){var a=this;this.buld_deck();firebase.auth().onAuthStateChanged(function(b){if(a.player.info=
b)a.message="Welcome "+b.displayName+"!",FIRESTORE.collection("leaderboard").doc(b.uid).get().then(function(c){c.exists?(c=c.data(),a.player.chips=c.chips,a.player.demerits=c.demerits):(FIRESTORE.collection("leaderboard").doc(b.uid).set({chips:100,demerits:0,displayName:b.displayName}),a.player.new=!0);a.clean_up()})});this.update_leaderboard();setInterval(function(){a.update_leaderboard()},3E4)},watch:{"player.chips":function(){this.player.info&&FIRESTORE.collection("leaderboard").doc(this.player.info.uid).update({chips:this.player.chips})},
"player.demerits":function(){FIRESTORE.collection("leaderboard").doc(this.player.info.uid).update({demerits:this.player.demerits})},"player.current_rank":function(){console.log("NOW RANKED "+this.player.current_rank)},state:function(){this.delay_interval=default_interval},deck:function(a,b){this.totals.player=this.get_total(this.hands.player);this.totals.dealer=this.get_total(this.hands.dealer);21<this.totals.player&&(this.message="Player BUST!",this.state="end-game",this.end_turn());21<this.totals.dealer&&
(this.message="Dealer BUST!",this.transaction("+",2),this.end_turn());21==this.totals.player&&(this.message="Blackjack!!",this.transaction("+",4),this.end_turn())}},methods:{end_turn:function(){this.state="end-game";this.clean_up()},buld_deck:function(){for(var a=this,b="A 2 3 4 5 6 7 8 9 10 J Q K".split(" "),c=["Clubs","Diamonds","Hearts","Spades"],d=0;6>d;d++)b.forEach(function(b){c.forEach(function(c){a.deck.push({value:b,suit:c,flipped:!0})})});this.deck=_.shuffle(this.deck)},deal_cards:function(){var a=
this;this.hands.dealer=[];this.hands.player=[];setTimeout(function(){a.state="dealing";a.message="Dealing cards";a.pull_cards("dealer",!0);a.pull_cards("dealer",!1);a.pull_cards("player",!0);a.pull_cards("player",!0);a.state="player-turn";a.message="Your Move";a.transaction("-")},200)},pull_cards:function(a,b){var c=_.take(this.deck,1);c.map(function(a){a.flipped=b});"dealer"==a?this.hands.dealer=this.hands.dealer.concat(c):this.hands.player=this.hands.player.concat(c);this.deck=_.drop(this.deck,
1)},action_hit:function(){this.pull_cards("player",!0)},action_stand:function(){this.dealer_move()},action_payback:function(){200<this.player.chips&&0<this.player.demerits&&(--this.player.demerits,this.player.chips-=200)},action_doubledown:function(){var a=this;this.transaction("-");this.table.bet*=2;this.action_hit();setTimeout(function(){a.dealer_move()},this.delay_interval)},dealer_move:function(){this.delay_interval=default_interval;this.hands.dealer.map(function(a){a.flipped=!0});this.totals.dealer=
this.get_total(this.hands.dealer);for(var a,b=0;10>b;b++)"end-game"!==this.state&&(console.log(this.state),a=this.get_total(this.hands.dealer),console.log(a),17>=a&&21>a&&(console.log("PULL"),this.pull_cards("dealer",!0),this.totals.dealer=this.get_total(this.hands.dealer),b++)),this.find_winner(),this.clean_up()},clean_up:function(){0==this.player.chips&&(this.player.chips=100,this.player.new||(this.player.demerits+=1,this.player.new=!1));this.table.bet>this.player.chips&&(this.table.bet=1);0>=this.table.bet&&
(this.table.bet=1);this.table.rewarded=!1},find_winner:function(){this.state="end-game";var a=this.get_total(this.hands.player),b=this.get_total(this.hands.dealer);a==b?(this.message="DRAW",this.transaction("+",1)):a>b?(this.message="Player WINS",this.transaction("+",2)):b>a&&(this.message="Dealer WINS")},get_total:function(a){var b=0,c=0;a.forEach(function(a){a.flipped&&("J"==a.value||"Q"==a.value||"K"==a.value?b+=10:"A"==a.value?c+=1:b+=Number(a.value))});for(a=0;a<c;a++)b=10<b?b+1:b+11,21<b&&(b-=
10);return b},delay:function(a){this.delay_interval+=300;setTimeout(a,this.delay_interval)},transaction:function(a,b){if(!this.table.rewarded)if("-"==a){var c=-this.table.bet;this.player.chips-=this.table.bet}else this.table.rewarded=!0,c=this.table.bet*b,this.player.chips+=c;this.table.payout=0<c?"+"+c:c;console.log("payout",c)},bet_up:function(a){this.table.bet+a<=this.player.chips&&(this.table.bet+=a)},bet_down:function(a){1<this.table.bet&&(this.table.bet-=a)},update_leaderboard:function(){var a=
this;FIRESTORE.collection("leaderboard").orderBy("chips","desc").get().then(function(b){a.leaderboard=[];var c=1;b.docs.forEach(function(b){b=b.data();b.displayName==a.player.info.displayName&&(a.player.current_rank=c);b.rank=c;a.leaderboard.push(b);c++})})}}});