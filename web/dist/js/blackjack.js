Vue.component("c-card",{template:"#template-card",props:["details"],data:function(){var a="playing-card--"+this.details.suit+" ",b=this.details.value;this.details.flipped||(a+="playing-card--back");return{extras:a,val:b}}});
var viewAuth=new Vue({el:"#view--auth",data:{username:"",email:"",password:"",error:!1,view:!1,info:!1},created:function(){var a=this;firebase.auth().onAuthStateChanged(function(b){a.info=b})},methods:{modal:function(a){this.view=a},log_in:function(){var a=this;firebase.auth().signInWithEmailAndPassword(this.email,this.password).then(function(b){a.info=b.user;a.modal(!1)}).catch(function(b){a.error=b.message})},sign_up:function(){var a=this;firebase.auth().createUserWithEmailAndPassword(this.email,
this.password).then(function(b){a.info=b.user;a.modal(!1);firebase.auth().currentUser.updateProfile({displayName:a.username})}).catch(function(b){a.error=b.message})},sign_out:function(){firebase.auth().signOut()}}}),default_interval=500,viewGameboard=new Vue({el:"#view--gameboard",data:{delay_interval:default_interval,message:"Welcome!",state:"new-game",deck:[],table:{rewarded:!1,bet:1},player:{chips:0,demerits:0,info:!1,new:!1,current_rank:!1},hands:{dealer:[],player:[]},template:{card:{value:0,
suit:0,flipped:!1}},leaderboard:[]},created:function(){var a=this;this.buld_deck();firebase.auth().onAuthStateChanged(function(b){if(a.player.info=b)a.message="Welcome "+b.displayName+"!",FIRESTORE.collection("leaderboard").doc(b.uid).get().then(function(c){c.exists?(c=c.data(),a.player.chips=c.chips,a.player.demerits=c.demerits):(FIRESTORE.collection("leaderboard").doc(b.uid).set({chips:100,demerits:0,displayName:b.displayName}),a.player.new=!0);a.clean_up()})});this.update_leaderboard();setInterval(function(){a.update_leaderboard()},
3E4)},watch:{"player.chips":function(){this.player.info&&FIRESTORE.collection("leaderboard").doc(this.player.info.uid).update({chips:this.player.chips})},"player.demerits":function(){FIRESTORE.collection("leaderboard").doc(this.player.info.uid).update({demerits:this.player.demerits})},"player.current_rank":function(){console.log("NOW RANKED "+this.player.current_rank)},state:function(){this.delay_interval=default_interval},deck:function(a,b){a=this.get_total(this.hands.player);b=this.get_total(this.hands.dealer);
21<a&&(this.message="Player BUST!",this.state="end-game");21<b&&(this.message="Dealer BUST!",this.state="end-game",this.transaction("+",2));21==a&&(this.message="Player has 21!",this.transaction("+",4));21==b&&(this.hands.dealer.map(function(a){a.flipped=!0}),this.message="Dealer has 21!")}},methods:{buld_deck:function(){for(var a=this,b="A 2 3 4 5 6 7 8 9 10 J Q K".split(" "),c=["Clubs","Diamonds","Hearts","Spades"],d=0;6>d;d++)b.forEach(function(b){c.forEach(function(c){a.deck.push({value:b,suit:c,
flipped:!0})})});this.deck=_.shuffle(this.deck)},deal_cards:function(){var a=this;this.state="dealing";this.message="Dealing cards";this.hands.dealer=[];this.delay(function(){a.hands.dealer=a.hands.dealer.concat(a.pull_cards(1,!0))});this.delay(function(){return a.hands.dealer=a.hands.dealer.concat(a.pull_cards(1,!1))});this.hands.player=[];this.delay(function(){return a.hands.player=a.hands.player.concat(a.pull_cards(1,!0))});this.delay(function(){a.hands.player=a.hands.player.concat(a.pull_cards(1,
!0));a.state="player-turn";a.message="Your Move"});this.transaction("-")},pull_cards:function(a,b){var c=_.take(this.deck,a);c.map(function(a){a.flipped=b});this.deck=_.drop(this.deck,a);return c},action_hit:function(){this.hands.player=this.hands.player.concat(this.pull_cards(1,!0))},action_stand:function(){this.dealer_move()},action_payback:function(){200<this.player.chips&&0<this.player.demerits&&(--this.player.demerits,this.player.chips-=200)},action_doubledown:function(){var a=this;this.transaction("-");
this.table.bet*=2;this.action_hit();setTimeout(function(){a.dealer_move()},this.delay_interval)},dealer_move:function(){var a=this;this.delay_interval=default_interval;if("end-game"!==this.state){this.hands.dealer.map(function(a){a.flipped=!0});for(var b=this.get_total(this.hands.dealer),c=0;10>c;c++)setTimeout(function(){b=a.get_total(a.hands.dealer);17>b&&21>b&&(a.hands.dealer=a.hands.dealer.concat(a.pull_cards(1,!0)),c++)},200);this.find_winner();this.clean_up()}},clean_up:function(){0==this.player.chips&&
(this.player.chips=100,this.player.new||(this.player.demerits+=1,this.player.new=!1));this.table.bet>this.player.chips&&(this.table.bet=1);0>=this.table.bet&&(this.table.bet=1);this.table.rewarded=!1;this.deck=this.deck.concat(this.hands.dealer);this.deck=this.deck.concat(this.hands.player)},find_winner:function(){this.state="end-game";var a=this.get_total(this.hands.player),b=this.get_total(this.hands.dealer);a==b?(this.message="DRAW",this.transaction("+",1)):a>b?(this.message="Player WINS",this.transaction("+",
2)):b>a&&(this.message="Dealer WINS")},get_total:function(a,b){b=void 0===b?!0:b;var c=0,d=0;a.forEach(function(a){if(a.flipped||b)"J"==a.value||"Q"==a.value||"K"==a.value?c+=10:"A"==a.value?d+=1:c+=Number(a.value)});for(a=0;a<d;a++)c=10<c?c+1:c+11,21<c&&(c-=10);return c},delay:function(a){this.delay_interval+=300;setTimeout(a,this.delay_interval)},transaction:function(a,b){this.table.rewarded||("-"==a?this.player.chips-=this.table.bet:(this.table.rewarded=!0,a=this.table.bet*b,console.log(a),this.player.chips+=
a))},bet_up:function(a){this.table.bet+a<=this.player.chips&&(this.table.bet+=a)},bet_down:function(a){1<this.table.bet&&(this.table.bet-=a)},update_leaderboard:function(){var a=this;FIRESTORE.collection("leaderboard").orderBy("chips","desc").get().then(function(b){a.leaderboard=[];var c=1;b.docs.forEach(function(b){b=b.data();b.displayName==a.player.info.displayName&&(a.player.current_rank=c);b.rank=c;a.leaderboard.push(b);c++})})}}});